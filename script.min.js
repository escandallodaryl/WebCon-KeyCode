const firebaseConfig={apiKey:"AIzaSyD0Z0EWvidFrMqQDeEBspGpyXRPv4Q0zyM",authDomain:"webcon-808c4.firebaseapp.com",databaseURL:"https://webcon-808c4-default-rtdb.firebaseio.com/",projectId:"webcon-808c4",storageBucket:"webcon-808c4.appspot.com",messagingSenderId:"701202929556",appId:"1:701202929556:web:9c25d0a6ab006edce5e181"};firebase.initializeApp(firebaseConfig);const db=firebase.database(),taskForm=document.getElementById("task-form"),taskInput=document.getElementById("task-input"),taskList=document.getElementById("task-list"),currentCodeVal=document.getElementById("current-code-val"),lastUpdatedVal=document.getElementById("last-updated-val"),nextUpdateVal=document.getElementById("next-update-val"),timeLeftDisplay=document.getElementById("time-left-val"),loginModal=document.getElementById("login-modal"),adminPassInput=document.getElementById("admin-pass-input"),togglePassword=document.getElementById("toggle-password"),confirmLogin=document.getElementById("confirm-login"),cancelLogin=document.getElementById("cancel-login"),loginBtn=document.getElementById("admin-login-btn"),logoutBtn=document.getElementById("admin-logout-btn"),clearAllBtn=document.getElementById("clear-all-btn");let countdownInterval;const ADMIN_PASSWORD="111";function checkAuth(){const isAdmin="true"===sessionStorage.getItem("isAdmin");document.getElementById("admin-controls").style.display=isAdmin?"block":"none",loginBtn.style.display=isAdmin?"none":"inline-block",logoutBtn.style.display=isAdmin?"inline-block":"none",clearAllBtn.style.display=isAdmin?"inline-block":"none",db.ref("keycodes").once("value",snapshot=>{const data=snapshot.val(),tasks=data?Object.values(data).reverse():[];renderUI(tasks)})}function renderUI(tasks=[]){taskList.innerHTML="";const isAdmin="true"===sessionStorage.getItem("isAdmin"),actionHeader=document.querySelector("#history-table th:nth-child(4)");if(actionHeader&&(actionHeader.style.display=isAdmin?"table-cell":"none"),tasks.length>0){const latest=tasks[0];currentCodeVal.innerText=latest.code,lastUpdatedVal.innerText=`${latest.date} ${latest.time}`;const nextTimeDate=new Date(latest.fullTimestamp+144e5);nextUpdateVal.innerText=nextTimeDate.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"}),clearInterval(countdownInterval),countdownInterval=setInterval(()=>{const now=(new Date).getTime(),expiration=latest.fullTimestamp+144e5,dist=expiration-now;if(dist<0)timeLeftDisplay.innerText="EXPIRED",timeLeftDisplay.style.color="red";else{const h=Math.floor(dist/36e5),m=Math.floor(dist%36e5/6e4),s=Math.floor(dist%6e4/1e3);timeLeftDisplay.innerText=`${h}h ${m}m ${s}s`,timeLeftDisplay.style.color="inherit"}},1e3),tasks.forEach(task=>{const row=document.createElement("tr");row.innerHTML=`\n                <td><strong>${task.code}</strong></td>\n                <td>${task.time}</td>\n                <td><small>${task.date}</small></td>\n                ${isAdmin?`<td><button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button></td>`:""}\n            `,taskList.appendChild(row)})}else currentCodeVal.innerText="--------",lastUpdatedVal.innerText="-",nextUpdateVal.innerText="-",timeLeftDisplay.innerText="0h 00m 00s"}loginBtn.addEventListener("click",()=>{loginModal.style.display="flex",adminPassInput.value=""}),cancelLogin.addEventListener("click",()=>{loginModal.style.display="none"}),togglePassword.addEventListener("click",()=>{const type="password"===adminPassInput.getAttribute("type")?"text":"password";adminPassInput.setAttribute("type",type),togglePassword.textContent="password"===type?"ðŸ‘ï¸":"ðŸ™ˆ"}),confirmLogin.addEventListener("click",()=>{"111"===adminPassInput.value?(sessionStorage.setItem("isAdmin","true"),loginModal.style.display="none",checkAuth()):alert("Incorrect password!")}),logoutBtn.addEventListener("click",()=>{sessionStorage.removeItem("isAdmin"),checkAuth()}),taskInput.addEventListener("input",e=>{let val=e.target.value.replace(/[^0-9]/g,"");val.length>12&&(val=val.substring(0,12)),e.target.value=val}),db.ref("keycodes").on("value",snapshot=>{const data=snapshot.val(),tasks=data?Object.values(data).reverse():[];renderUI(tasks)}),taskForm.addEventListener("submit",e=>{e.preventDefault();const val=taskInput.value.trim();if(val.length<8)return alert("Error: KeyCode must be at least 8 digits."),void(taskInput.style.borderColor="red");taskInput.style.borderColor="#ddd";const now=new Date,newTask={id:Date.now(),code:val,date:now.toLocaleDateString("en-US",{month:"long",day:"2-digit",year:"numeric"}),time:now.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),fullTimestamp:now.getTime()};db.ref("keycodes/"+newTask.id).set(newTask),taskInput.value=""}),window.deleteTask=id=>{confirm("Delete this record?")&&db.ref("keycodes/"+id).remove()},clearAllBtn.addEventListener("click",()=>{confirm("Clear ALL records?")&&db.ref("keycodes").remove()}),document.addEventListener("DOMContentLoaded",checkAuth);