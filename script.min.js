const taskForm=document.getElementById("task-form"),taskInput=document.getElementById("task-input"),taskList=document.getElementById("task-list"),currentCodeVal=document.getElementById("current-code-val"),lastUpdatedVal=document.getElementById("last-updated-val"),nextUpdateVal=document.getElementById("next-update-val");function getTasks(){const tasks=JSON.parse(localStorage.getItem("keycodes"))||[];if(taskList.innerHTML="",tasks.length>0){const latest=tasks[0];currentCodeVal.innerText=latest.code,lastUpdatedVal.innerText=`${latest.date} ${latest.time}`;const nextTime=new Date(latest.fullTimestamp+144e5);nextUpdateVal.innerText=nextTime.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),tasks.forEach(task=>{const row=document.createElement("tr");row.innerHTML=`\n                <td><strong>${task.code}</strong></td>\n                <td>${task.time}</td>\n                <td><small>${task.date}</small></td>\n                <td><button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button></td>\n            `,taskList.appendChild(row)})}else currentCodeVal.innerText="--------",lastUpdatedVal.innerText="-",nextUpdateVal.innerText="-"}function deleteTask(id){let tasks=JSON.parse(localStorage.getItem("keycodes"));tasks=tasks.filter(task=>task.id!==id),localStorage.setItem("keycodes",JSON.stringify(tasks)),getTasks()}document.addEventListener("DOMContentLoaded",getTasks),taskForm.addEventListener("submit",e=>{e.preventDefault();const tasks=JSON.parse(localStorage.getItem("keycodes"))||[],now=new Date,dateStr=now.toLocaleDateString("en-US",{month:"long",day:"2-digit",year:"numeric"}),timeStr=now.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),newTask={id:Date.now(),code:taskInput.value,date:dateStr,time:timeStr,fullTimestamp:now.getTime()};tasks.unshift(newTask),localStorage.setItem("keycodes",JSON.stringify(tasks)),taskInput.value="",getTasks()});const adminControls=document.getElementById("admin-controls"),loginBtn=document.getElementById("admin-login-btn"),logoutBtn=document.getElementById("admin-logout-btn"),ADMIN_PASSWORD="admin123";function checkAuth(){const isAdmin="true"===sessionStorage.getItem("isAdmin");isAdmin?(adminControls.style.display="block",loginBtn.style.display="none",logoutBtn.style.display="inline-block",document.querySelectorAll(".admin-only").forEach(el=>el.style.display="table-cell")):(adminControls.style.display="none",loginBtn.style.display="inline-block",logoutBtn.style.display="none",document.querySelectorAll(".admin-only").forEach(el=>el.style.display="none"))}function getTasks(){const tasks=JSON.parse(localStorage.getItem("keycodes"))||[],taskList=document.getElementById("task-list");taskList.innerHTML="";const isAdmin="true"===sessionStorage.getItem("isAdmin");if(tasks.length>0){const latest=tasks[0];document.getElementById("current-code-val").innerText=latest.code,document.getElementById("last-updated-val").innerText=`${latest.date} ${latest.time}`,tasks.forEach(task=>{const row=document.createElement("tr");row.innerHTML=`\n                <td><strong>${task.code}</strong></td>\n                <td>${task.time}</td>\n                <td><small>${task.date}</small></td>\n                <td class="admin-only" style="display: ${isAdmin?"table-cell":"none"}">\n                    <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>\n                </td>\n            `,taskList.appendChild(row)})}}loginBtn.addEventListener("click",()=>{const pass=prompt("Enter Admin Password:");"admin123"===pass?(sessionStorage.setItem("isAdmin","true"),checkAuth()):alert("Incorrect password!")}),logoutBtn.addEventListener("click",()=>{sessionStorage.removeItem("isAdmin"),checkAuth()}),document.addEventListener("DOMContentLoaded",()=>{checkAuth(),getTasks()});const clearAllBtn=document.getElementById("clear-all-btn");function checkAuth(){const isAdmin="true"===sessionStorage.getItem("isAdmin");isAdmin?(adminControls.style.display="block",loginBtn.style.display="none",logoutBtn.style.display="inline-block",clearAllBtn.style.display="inline-block",document.querySelectorAll(".admin-only").forEach(el=>el.style.display="table-cell")):(adminControls.style.display="none",loginBtn.style.display="inline-block",logoutBtn.style.display="none",clearAllBtn.style.display="none",document.querySelectorAll(".admin-only").forEach(el=>el.style.display="none"))}function getTasks(){const tasks=JSON.parse(localStorage.getItem("keycodes"))||[],taskList=document.getElementById("task-list");taskList.innerHTML="";const isAdmin="true"===sessionStorage.getItem("isAdmin");if(tasks.length>0){const latest=tasks[0];currentCodeVal.innerText=latest.code,lastUpdatedVal.innerText=`${latest.date} ${latest.time}`,tasks.forEach(task=>{const row=document.createElement("tr");row.innerHTML=`\n                <td><strong>${task.code}</strong></td>\n                <td>${task.time}</td>\n                <td><small>${task.date}</small></td>\n                <td class="admin-only" style="display: ${isAdmin?"table-cell":"none"}">\n                    <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>\n                </td>\n            `,taskList.appendChild(row)})}else currentCodeVal.innerText="--------",lastUpdatedVal.innerText="-",nextUpdateVal.innerText="-"}let countdownInterval;function updateCountdown(){const tasks=JSON.parse(localStorage.getItem("keycodes"))||[],timeLeftDisplay=document.getElementById("time-left-val");if(0===tasks.length)return void(timeLeftDisplay.innerText="0h 00m 00s");const latest=tasks[0],now=(new Date).getTime(),expirationTime=latest.fullTimestamp+144e5,distance=expirationTime-now;if(distance<0)return timeLeftDisplay.innerText="EXPIRED",void(timeLeftDisplay.style.color="var(--danger-red)");timeLeftDisplay.style.color="inherit";const hours=Math.floor(distance%864e5/36e5),minutes=Math.floor(distance%36e5/6e4),seconds=Math.floor(distance%6e4/1e3);timeLeftDisplay.innerText=`${hours}h ${minutes}m ${seconds}s`}function getTasks(){const tasks=JSON.parse(localStorage.getItem("keycodes"))||[],taskList=document.getElementById("task-list");taskList.innerHTML="";const isAdmin="true"===sessionStorage.getItem("isAdmin");if(tasks.length>0){const latest=tasks[0];document.getElementById("current-code-val").innerText=latest.code,document.getElementById("last-updated-val").innerText=`${latest.date} ${latest.time}`;const nextTimeDate=new Date(latest.fullTimestamp+144e5);document.getElementById("next-update-val").innerText=nextTimeDate.toLocaleString("en-US",{month:"long",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),clearInterval(countdownInterval),countdownInterval=setInterval(updateCountdown,1e3),updateCountdown(),tasks.forEach(task=>{const row=document.createElement("tr");row.innerHTML=`\n                <td><strong>${task.code}</strong></td>\n                <td>${task.time}</td>\n                <td><small>${task.date}</small></td>\n                <td class="admin-only" style="display: ${isAdmin?"table-cell":"none"}">\n                    <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>\n                </td>\n            `,taskList.appendChild(row)})}else document.getElementById("current-code-val").innerText="--------",document.getElementById("last-updated-val").innerText="-",document.getElementById("next-update-val").innerText="-",document.getElementById("time-left-val").innerText="4h 00m 00s",clearInterval(countdownInterval)}clearAllBtn.addEventListener("click",()=>{const confirmClear=confirm("Are you sure you want to delete ALL history? This cannot be undone.");confirmClear&&(localStorage.removeItem("keycodes"),getTasks(),alert("All records have been cleared."))});